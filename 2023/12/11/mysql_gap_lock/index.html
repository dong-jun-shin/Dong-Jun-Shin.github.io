<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>MySQL - Gap Lock</title>
  <meta
    name="description"
    content="배경회사에서 운영중인 서비스에 Dead lock이 주기적으로 발생하고 있는 것을 알게 되었습니다. 왜 Dead lock이 발생했는지, 트래킹하는 과정에서 알게 된 Gap Lock을 공부하며 정리하게 되었습니다.1. Gap Lock이란일단 예시를 통해 Gap Lock이 왜 생겼는지 ..."
  />
  <!-- Twitter Cards -->
<meta name="twitter:title" content="MySQL - Gap Lock">
<meta name="twitter:description" content="배경

회사에서 운영중인 서비스에 Dead lock이 주기적으로 발생하고 있는 것을 알게 되었습니다. 왜 Dead lock이 발생했는지, 트래킹하는 과정에서 알게 된 Gap Lock을 공부하며 정리하게 되었습니다.

1. Gap Lock이란

일단 예시를 통해 Gap Lock이 왜 생겼는지 설명해보겠습니다.

테이블에 새로운 데이터를 추가하기 위한 서비스가 있고, 이 서비스에 요청이 동시에 들어와 병렬로 처리되어야 하는 상황을 가정해보겠습니다.

이 때, 첫번째 요청의 데이터(A1)와 두번째 요청의 데이터(A2)는 특정 레코드 2개(A0, A10) 사이에 들어가게 됩니다. 그러면 이 2개의 레코드는 같은 위치를 건드리게 되기 때문에 이 공간(간격)에 대한 제어가 필요하게 됩니다.

이런 상황처럼 레코드가 아닌 특정 범위에 추가, 갱신 제한이 필요한 경우가 있고 실제 존재하지 않는 레코드 공간(간격)에 대해 제어권을 얻기 위해 잠그는 것을 Gap Lock이라고 합니다.

2. 존재하지 않는 간격을 잠근다는 게 무슨 말인가요?


[DB에 존재하는 테이블 예시]

그림과 같이 아직 추가되어 있지 않은 부분을 Gap(간격)이라고 말하고 있습니다.

3. 그럼 Gap Lock(간격)은 언제 생성되나요?

Gap Lock은 DML(Insert, Update, Delete) 연산할 때, 조건 컬럼에 Index가 걸려있지 않거나, Index가 Unique하지 않다면 SELECT .. FOR UPDATE를 했을 때 생성됩니다.

4. Gap Lock이 무엇이고, 언제 생성되는건 알겠는데 범위가 지정되는 기준을 모르겠어요


[DB에 존재하는 테이블 예시]

Gap Lock은 특정 레코드를 기준으로 범위가 지정됩니다. 여기서 특정 레코드는 무엇이고, 이 레코드는 어떻게 선택되며, 이 레코드로 어떻게 범위를 구성하는지 3개의 항목으로 나누어 위 테이블을 예시로 설명하겠습니다.


  특정 레코드란?
    
      Gap Lock의 기준점이 되는 레코드로, 범위 시작(from)부터 범위 끝(to) 중 범위 끝(to)의 역할을 합니다.
    
  
  특정 레코드는 어떤 기준으로 선택되나요?
    
      선택된 Index와 비교 연산(&lt;, &gt;, ≤, ≥) 방식을 통해 선택이 됩니다.
        
          숫자: 크기 비교
          문자열: 문자열 비교
        
      
      좀 더 구체적으로 말하면, 우리가 Select 쿼리를 실행했을 때, Where에 어떤 조건이 있는지에 따라 사용하는 Index가 선택되고, 선택된 Index에 해당하는 조건을 순서대로 비교 연산해서 특정 레코드를 선택하는 것과 유사합니다.
      e.g. 선택하는 예시는 아래와 같습니다.
        
          테이블에는 ID, Name으로 구성된 idx_dummy_id_name  Unique 인덱스가 있다고 가정해보겠습니다.
          이제 우리는 새로운 레코드(6, D1)를 추가하려고 합니다.
          Entity가 존재하지 않을 때만 추가하기 위해 ID, Name(6, D1)을 조건으로 SELECT .. FOR UPDATE를 하게 됩니다.
          이 때  idx_dummy_id_name 인덱스를 사용한다면, Gap Lock을 얻기위해 ID &gt; 6, Name &gt; ‘D1’ 의 조건으로 비교연산을 통해 특정 레코드(8, E)를 얻습니다.
        
      
    
  
  특정 레코드가 구성되는 범위는 어떻게 되나요?
    
      위에 설명한대로 특정 레코드는 범위 끝(to)의 역할을 합니다. 그럼 범위 시작(from)을 정해야 하는데, 이건 기준이 되는 Index 조건 컬럼들을 순서대로 비교 연산 기준으로 정렬했을 때, 범위 끝(to) 레코드에서 앞 레코드로 정해집니다.
      만약 Unique index 등 복합 인덱스가 걸려 있다면, Index Sequence에 따라 순차적으로 조건을 비교하게 됩니다. (Gap Lock의 범위를 알고 싶다면 Index Sequence에 따라 순차적으로 판단하면서 알 수 있습니다!)
      이것을 정리하면 Gap Lock의 범위는 특정 레코드의 앞 레코드 ~ 특정 레코드로 정의할 수 있습니다.
      e.g. 특정 레코드의 앞 레코드(5, D) ~ 특정 레코드(8, E)
    
  


5. Gap Lock을 사용할 때 주의할 점


  Gap Lock은 아래와 같은 상황에서 Dead Lock이 발생할 수 있기 때문에 주의가 필요합니다.
    
      복수의 트랜잭션이 서로 SELECT .. FOR UPDATE를 하면 서로 같은 GAP LOCK을 얻게 되고 DML 처리를 하면 Dead Lock이 발생
    
  
  B-Tree Index에 대해 구성된 페이지들의 마지막 레코드가 조회 범위에 포함되면 특정 레코드 대신 supremum pseudo-record(Index가 가지는 가장 큰 가상의 시스템 값) 가 선택될 수 있습니다.
    
      범위를 조회하며 SELECT .. FOR UPDATE의 조건에 해당하는 레코드와 간격을 잠그고, 마지막 레코드까지 왔다면 그 다음 레코드(supremum record)에 대해 같은 Lock 절차를 밟게 됩니다. 그리고 다음 페이지의 레코드를 읽어 조건이 일치하지 않을 때까지 Lock 절차를 진행합니다.
      이 문제는 아래의 방법을 통해 피할 수 있습니다.
        
          Isolation Level을 Read-Committed로 수정
            
              Read-Committed는 Gap Lock을 거의 사용하지 않기 때문에, Gap Lock의 성격을 가진 supremum record 는 사용되지 않게 됩니다.
            
          
          BETWEEN AND 키워드 대신 IN을 사용
            
              IN은 조건 여러개를 합친 동등(=) 비교로 실행되기 때문에, Unique함이 보장되어 Gap Lock을 사용하지 않게 됩니다.
            
          
        
      
    
  


6. Gap Lock 예제

같은 DB에 접속한 Client 1, Client 2에 아래 쿼리를 입력하면서 Gap Lock의 생성과 Gap Lock에 의한 대기를 확인할 수 있습니다. 또 예제 데이터를 Index 값의 경계 부근 값(특정 레코드의 기준 컬럼 값이 ‘5’라면 4, 4.9, 5.1, 6 등)으로 대입하면서 확인해보면 더 깊게 Gap Lock을 이해하실 수 있을 겁니다.

/* 테스트 환경 구성 시작 */
-- 테스트를 위해 Client 1의 Auto commit을 비활성화
SET AUTOCOMMIT = FALSE;
SHOW VARIABLES LIKE '%autocommit%';
-- 복합인덱스로 구성된 테이블 생성
CREATE TABLE example_compound_index (
id INT AUTO_INCREMENT PRIMARY KEY,
uuid VARCHAR(36),
name VARCHAR(50),
other_column INT,
UNIQUE KEY idx_uuid_name (uuid, name)
);
-- 예제 데이터 삽입 (uuid의 맨 앞과 뒤를 수정하여 연속되지 않고 범위가 생기도록 함)
INSERT INTO example_compound_index(uuid, name, other_column) VALUES ('123e4567-e89b-12d3-a456-426614174001', 'John1', 100);
INSERT INTO example_compound_index(uuid, name, other_column) VALUES ('123e4567-e89b-12d3-a456-426614174005', 'John2', 200);
INSERT INTO example_compound_index(uuid, name, other_column) VALUES ('923e4567-e89b-12d3-a456-426614174001', 'John3', 300);
INSERT INTO example_compound_index(uuid, name, other_column) VALUES ('923e4567-e89b-12d3-a456-426614174002', 'John4', 400);
/* 테스트 환경 구성 끝 */

/* Client 1에서 실행하는 쿼리 */
-- Client 1의 Transaction 시작
START TRANSACTION;
-- 123..005 보다 큰 123..008을 조회했기 때문에 923..001 레코드가 Gap Lock의 기준이 됨
SELECT * FROM example_compound_index WHERE uuid = '123e4567-e89b-12d3-a456-426614174008' AND name = 'John4' FOR UPDATE;
/* Client 1에서 실행하는 쿼리 끝 */

/* Client 2에서 실행하는 쿼리 */
-- 테스트를 위해 Client 2의 Auto commit을 비활성화
SET AUTOCOMMIT = FALSE;
SHOW VARIABLES LIKE '%autocommit%';

-- Client 2의 Transaction 시작
START TRANSACTION;
-- Client 1에 의해 923..001 레코드 Gap Lock이 생겨있고, '5as..0w3'이나 '6as..0w3'은 '123..005 ~ 923..001' 사이에 추가하기 때문에 대기
INSERT INTO example_compound_index VALUES (6, '5asdasds-weio-wef2-iju9-2389070fj0w3', 'John2', 200);
INSERT INTO example_compound_index VALUES (6, '6asdasds-weio-wef2-iju9-2389070fj0w3', 'John2', 200);
/* Client 2에서 실행하는 쿼리 끝 */

/* 상태 확인을 위한 쿼리 */
-- Transaction, 생성된 Lock, Lock에 의해 대기중인 쿼리 확인
SELECT * FROM information_schema.INNODB_TRX;
SELECT * FROM performance_schema.DATA_LOCKS;
SELECT * FROM performance_schema.DATA_LOCK_WAITS;

-- Transaction 종료를 위한 쿼리
COMMIT;
ROLLBACK;


">



<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dong-jun-shin.github.io/images/DevLang_MySQL/logo.png">


<!-- Open Graph -->
<meta property="og:locale" content="">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL - Gap Lock">

<meta property="og:image" content="https://dong-jun-shin.github.io/images/DevLang_MySQL/logo.png">


<meta property="og:description" content="배경

회사에서 운영중인 서비스에 Dead lock이 주기적으로 발생하고 있는 것을 알게 되었습니다. 왜 Dead lock이 발생했는지, 트래킹하는 과정에서 알게 된 Gap Lock을 공부하며 정리하게 되었습니다.

1. Gap Lock이란

일단 예시를 통해 Gap Lock이 왜 생겼는지 설명해보겠습니다.

테이블에 새로운 데이터를 추가하기 위한 서비스가 있고, 이 서비스에 요청이 동시에 들어와 병렬로 처리되어야 하는 상황을 가정해보겠습니다.

이 때, 첫번째 요청의 데이터(A1)와 두번째 요청의 데이터(A2)는 특정 레코드 2개(A0, A10) 사이에 들어가게 됩니다. 그러면 이 2개의 레코드는 같은 위치를 건드리게 되기 때문에 이 공간(간격)에 대한 제어가 필요하게 됩니다.

이런 상황처럼 레코드가 아닌 특정 범위에 추가, 갱신 제한이 필요한 경우가 있고 실제 존재하지 않는 레코드 공간(간격)에 대해 제어권을 얻기 위해 잠그는 것을 Gap Lock이라고 합니다.

2. 존재하지 않는 간격을 잠근다는 게 무슨 말인가요?


[DB에 존재하는 테이블 예시]

그림과 같이 아직 추가되어 있지 않은 부분을 Gap(간격)이라고 말하고 있습니다.

3. 그럼 Gap Lock(간격)은 언제 생성되나요?

Gap Lock은 DML(Insert, Update, Delete) 연산할 때, 조건 컬럼에 Index가 걸려있지 않거나, Index가 Unique하지 않다면 SELECT .. FOR UPDATE를 했을 때 생성됩니다.

4. Gap Lock이 무엇이고, 언제 생성되는건 알겠는데 범위가 지정되는 기준을 모르겠어요


[DB에 존재하는 테이블 예시]

Gap Lock은 특정 레코드를 기준으로 범위가 지정됩니다. 여기서 특정 레코드는 무엇이고, 이 레코드는 어떻게 선택되며, 이 레코드로 어떻게 범위를 구성하는지 3개의 항목으로 나누어 위 테이블을 예시로 설명하겠습니다.


  특정 레코드란?
    
      Gap Lock의 기준점이 되는 레코드로, 범위 시작(from)부터 범위 끝(to) 중 범위 끝(to)의 역할을 합니다.
    
  
  특정 레코드는 어떤 기준으로 선택되나요?
    
      선택된 Index와 비교 연산(&lt;, &gt;, ≤, ≥) 방식을 통해 선택이 됩니다.
        
          숫자: 크기 비교
          문자열: 문자열 비교
        
      
      좀 더 구체적으로 말하면, 우리가 Select 쿼리를 실행했을 때, Where에 어떤 조건이 있는지에 따라 사용하는 Index가 선택되고, 선택된 Index에 해당하는 조건을 순서대로 비교 연산해서 특정 레코드를 선택하는 것과 유사합니다.
      e.g. 선택하는 예시는 아래와 같습니다.
        
          테이블에는 ID, Name으로 구성된 idx_dummy_id_name  Unique 인덱스가 있다고 가정해보겠습니다.
          이제 우리는 새로운 레코드(6, D1)를 추가하려고 합니다.
          Entity가 존재하지 않을 때만 추가하기 위해 ID, Name(6, D1)을 조건으로 SELECT .. FOR UPDATE를 하게 됩니다.
          이 때  idx_dummy_id_name 인덱스를 사용한다면, Gap Lock을 얻기위해 ID &gt; 6, Name &gt; ‘D1’ 의 조건으로 비교연산을 통해 특정 레코드(8, E)를 얻습니다.
        
      
    
  
  특정 레코드가 구성되는 범위는 어떻게 되나요?
    
      위에 설명한대로 특정 레코드는 범위 끝(to)의 역할을 합니다. 그럼 범위 시작(from)을 정해야 하는데, 이건 기준이 되는 Index 조건 컬럼들을 순서대로 비교 연산 기준으로 정렬했을 때, 범위 끝(to) 레코드에서 앞 레코드로 정해집니다.
      만약 Unique index 등 복합 인덱스가 걸려 있다면, Index Sequence에 따라 순차적으로 조건을 비교하게 됩니다. (Gap Lock의 범위를 알고 싶다면 Index Sequence에 따라 순차적으로 판단하면서 알 수 있습니다!)
      이것을 정리하면 Gap Lock의 범위는 특정 레코드의 앞 레코드 ~ 특정 레코드로 정의할 수 있습니다.
      e.g. 특정 레코드의 앞 레코드(5, D) ~ 특정 레코드(8, E)
    
  


5. Gap Lock을 사용할 때 주의할 점


  Gap Lock은 아래와 같은 상황에서 Dead Lock이 발생할 수 있기 때문에 주의가 필요합니다.
    
      복수의 트랜잭션이 서로 SELECT .. FOR UPDATE를 하면 서로 같은 GAP LOCK을 얻게 되고 DML 처리를 하면 Dead Lock이 발생
    
  
  B-Tree Index에 대해 구성된 페이지들의 마지막 레코드가 조회 범위에 포함되면 특정 레코드 대신 supremum pseudo-record(Index가 가지는 가장 큰 가상의 시스템 값) 가 선택될 수 있습니다.
    
      범위를 조회하며 SELECT .. FOR UPDATE의 조건에 해당하는 레코드와 간격을 잠그고, 마지막 레코드까지 왔다면 그 다음 레코드(supremum record)에 대해 같은 Lock 절차를 밟게 됩니다. 그리고 다음 페이지의 레코드를 읽어 조건이 일치하지 않을 때까지 Lock 절차를 진행합니다.
      이 문제는 아래의 방법을 통해 피할 수 있습니다.
        
          Isolation Level을 Read-Committed로 수정
            
              Read-Committed는 Gap Lock을 거의 사용하지 않기 때문에, Gap Lock의 성격을 가진 supremum record 는 사용되지 않게 됩니다.
            
          
          BETWEEN AND 키워드 대신 IN을 사용
            
              IN은 조건 여러개를 합친 동등(=) 비교로 실행되기 때문에, Unique함이 보장되어 Gap Lock을 사용하지 않게 됩니다.
            
          
        
      
    
  


6. Gap Lock 예제

같은 DB에 접속한 Client 1, Client 2에 아래 쿼리를 입력하면서 Gap Lock의 생성과 Gap Lock에 의한 대기를 확인할 수 있습니다. 또 예제 데이터를 Index 값의 경계 부근 값(특정 레코드의 기준 컬럼 값이 ‘5’라면 4, 4.9, 5.1, 6 등)으로 대입하면서 확인해보면 더 깊게 Gap Lock을 이해하실 수 있을 겁니다.

/* 테스트 환경 구성 시작 */
-- 테스트를 위해 Client 1의 Auto commit을 비활성화
SET AUTOCOMMIT = FALSE;
SHOW VARIABLES LIKE '%autocommit%';
-- 복합인덱스로 구성된 테이블 생성
CREATE TABLE example_compound_index (
id INT AUTO_INCREMENT PRIMARY KEY,
uuid VARCHAR(36),
name VARCHAR(50),
other_column INT,
UNIQUE KEY idx_uuid_name (uuid, name)
);
-- 예제 데이터 삽입 (uuid의 맨 앞과 뒤를 수정하여 연속되지 않고 범위가 생기도록 함)
INSERT INTO example_compound_index(uuid, name, other_column) VALUES ('123e4567-e89b-12d3-a456-426614174001', 'John1', 100);
INSERT INTO example_compound_index(uuid, name, other_column) VALUES ('123e4567-e89b-12d3-a456-426614174005', 'John2', 200);
INSERT INTO example_compound_index(uuid, name, other_column) VALUES ('923e4567-e89b-12d3-a456-426614174001', 'John3', 300);
INSERT INTO example_compound_index(uuid, name, other_column) VALUES ('923e4567-e89b-12d3-a456-426614174002', 'John4', 400);
/* 테스트 환경 구성 끝 */

/* Client 1에서 실행하는 쿼리 */
-- Client 1의 Transaction 시작
START TRANSACTION;
-- 123..005 보다 큰 123..008을 조회했기 때문에 923..001 레코드가 Gap Lock의 기준이 됨
SELECT * FROM example_compound_index WHERE uuid = '123e4567-e89b-12d3-a456-426614174008' AND name = 'John4' FOR UPDATE;
/* Client 1에서 실행하는 쿼리 끝 */

/* Client 2에서 실행하는 쿼리 */
-- 테스트를 위해 Client 2의 Auto commit을 비활성화
SET AUTOCOMMIT = FALSE;
SHOW VARIABLES LIKE '%autocommit%';

-- Client 2의 Transaction 시작
START TRANSACTION;
-- Client 1에 의해 923..001 레코드 Gap Lock이 생겨있고, '5as..0w3'이나 '6as..0w3'은 '123..005 ~ 923..001' 사이에 추가하기 때문에 대기
INSERT INTO example_compound_index VALUES (6, '5asdasds-weio-wef2-iju9-2389070fj0w3', 'John2', 200);
INSERT INTO example_compound_index VALUES (6, '6asdasds-weio-wef2-iju9-2389070fj0w3', 'John2', 200);
/* Client 2에서 실행하는 쿼리 끝 */

/* 상태 확인을 위한 쿼리 */
-- Transaction, 생성된 Lock, Lock에 의해 대기중인 쿼리 확인
SELECT * FROM information_schema.INNODB_TRX;
SELECT * FROM performance_schema.DATA_LOCKS;
SELECT * FROM performance_schema.DATA_LOCK_WAITS;

-- Transaction 종료를 위한 쿼리
COMMIT;
ROLLBACK;


">
<meta property="og:url" content="https://dong-jun-shin.github.io/2023/12/11/mysql_gap_lock/">
<meta property="og:site_name" content="Jun's Dev_Blog">
  <link rel="canonical" href="https://dong-jun-shin.github.io/2023/12/11/mysql_gap_lock/" />
  <link
    rel="alternate"
    type="application/rss+xml"
    title="Jun's Dev_Blog"
    href="https://dong-jun-shin.github.io/feed.xml"
  />
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css?family=Volkhov:400,700" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@200;300;400;500;700;900&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@700&display=swap" rel="stylesheet" />
  <!-- Common -->
  <style>
    
    /*! normalize.css v7.0.0 | MIT License | github.com/necolas/normalize.css */html,body{scroll-behavior:smooth}html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{font-weight:normal;letter-spacing:0;margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:rgba(0,0,0,0);-webkit-text-decoration-skip:objects}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:"Noto Sans KR",sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,html [type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}body,h1,h2,h3,h4,h5,h6,p,blockquote,pre,dl,dd,ol,ul,fieldset,legend,figure,hr{margin:0;padding:0}li>ul,li>ol{margin-bottom:0}table{border:.14em solid #000;border-collapse:collapse;border-spacing:0;word-break:initial;width:100%}table tr:nth-child(even){background-color:#f2fafd}thead{background-color:#a0d0ee}table th{text-align:center;padding:6px 13px;border:.1em solid #757575}table td{padding:6px 13px;border:.1em solid #757575}table tr{padding:6px 13px;border:.1em solid #757575}@-webkit-keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.icon{position:relative;display:inline-block;width:25px;height:25px;overflow:hidden;fill:currentColor}.icon__cnt{width:100%;height:100%;background:inherit;fill:inherit;pointer-events:none;transform:translateX(0);-ms-transform:translate(0.5px, -0.3px)}.icon--m{width:50px;height:50px}.icon--l{width:100px;height:100px}.icon--xl{width:150px;height:150px}.icon--xxl{width:200px;height:200px}.icon__spinner{position:absolute;top:0;left:0;width:100%;height:100%}.icon--ei-spinner .icon__spinner,.icon--ei-spinner-2 .icon__spinner{-webkit-animation:spin 1s steps(12) infinite;animation:spin 1s steps(12) infinite}.icon--ei-spinner-3 .icon__spinner{-webkit-animation:spin 1.5s linear infinite;animation:spin 1.5s linear infinite}.icon--ei-sc-facebook{fill:#3b5998}.icon--ei-sc-github{fill:#333}.icon--ei-sc-google-plus{fill:#dd4b39}.icon--ei-sc-instagram{fill:#3f729b}.icon--ei-sc-linkedin{fill:#0976b4}.icon--ei-sc-odnoklassniki{fill:#ed812b}.icon--ei-sc-skype{fill:#00aff0}.icon--ei-sc-soundcloud{fill:#f80}.icon--ei-sc-tumblr{fill:#35465c}.icon--ei-sc-twitter{fill:#55acee}.icon--ei-sc-vimeo{fill:#1ab7ea}.icon--ei-sc-vk{fill:#45668e}.icon--ei-sc-youtube{fill:#e52d27}.icon--ei-sc-pinterest{fill:#bd081c}.icon--ei-sc-telegram{fill:#08c}*,*::after,*::before{box-sizing:border-box}h1,h2,h3,h4,h5,h6,ul,ol,dl,blockquote,p,address,hr,table,fieldset,figure,pre{margin-bottom:20px}ul,ol,dd{margin-left:20px}.highlight{background:#f7f7f7}.highlighter-rouge .highlight{background:#0d1117;color:#e6edf3;border-radius:10px}.highlight .c{color:#7ca668;font-style:italic}.highlight .ch{color:#7ca668;font-style:italic}.highlight .cm{color:#7ca668;font-style:italic}.highlight .cp{color:#7ca668;font-style:italic;font-weight:normal}.highlight .cpf{color:#7ca668;font-style:italic}.highlight .c1{color:#7ca668;font-style:italic}.highlight .cs{color:#7ca668;font-style:italic}.highlight .err{color:#f85149}.highlight .esc{color:#e6edf3}.highlight .g{color:#e6edf3}.highlight .k{color:#c586c0}.highlight .l{color:#a5d6ff}.highlight .n{color:#e6edf3}.highlight .o{color:#d4d4d4}.highlight .x{color:#e6edf3}.highlight .p{color:#d4d4d4}.highlight .gd{color:#ffa198;background-color:#490202}.highlight .ge{color:#e6edf3;font-style:italic}.highlight .ges{color:#e6edf3;font-weight:bold;font-style:italic}.highlight .gr{color:#ffa198}.highlight .gh{color:#79c0ff;font-weight:bold}.highlight .gi{color:#56d364;background-color:#0f5323}.highlight .go{color:#8b949e}.highlight .gp{color:#8b949e}.highlight .gs{color:#e6edf3;font-weight:bold}.highlight .gu{color:#79c0ff}.highlight .gt{color:#ff7b72}.highlight .g-Underline{color:#e6edf3;text-decoration:underline}.highlight .kc{color:#79c0ff}.highlight .kd{color:#569cd6}.highlight .kn{color:#ff7b72}.highlight .kp{color:#79c0ff}.highlight .kr{color:#4ec9b0}.highlight .kt{color:#4ec9b0}.highlight .ld{color:#ce9178}.highlight .sd{color:#a5d6ff}.highlight .na{color:#e6edf3}.highlight .nb{color:#4ec9b0}.highlight .nc{color:#4ec9b0;font-weight:bold}.highlight .no{color:#79c0ff;font-weight:bold}.highlight .nd{color:#d2a8ff;font-weight:bold}.highlight .ni{color:#ffa657}.highlight .ne{color:#f0883e;font-weight:bold}.highlight .nf{color:#dcdcaa;font-weight:bold}.highlight .nl{color:#4ec9b0;font-weight:bold}.highlight .nn{color:#ff7b72}.highlight .nx{color:#9cdcfe}.highlight .py{color:#79c0ff}.highlight .nt{color:#4ec9b0}.highlight .nv{color:#79c0ff}.highlight .ow{color:#ff7b72;font-weight:bold}.highlight .pm{color:#e6edf3}.highlight .w{color:#6e7681}.highlight .mb{color:#a5d6ff}.highlight .mf{color:#b5cea8}.highlight .mh{color:#a5d6ff}.highlight .mi{color:#b5cea8}.highlight .mo{color:#a5d6ff}.highlight .sa{color:#79c0ff}.highlight .sb{color:#a5d6ff}.highlight .sc{color:#a5d6ff}.highlight .dl{color:#ce9178}.highlight .sd{color:#a5d6ff}.highlight .s{color:#ce9178}.highlight .s1{color:#ce9178}.highlight .s2{color:#ce9178}.highlight .se{color:#79c0ff}.highlight .sh{color:#79c0ff}.highlight .si{color:#a5d6ff}.highlight .sx{color:#a5d6ff}.highlight .sr{color:#79c0ff}.highlight .ss{color:#a5d6ff}.highlight .bp{color:#e6edf3}.highlight .fm{color:#d2a8ff;font-weight:bold}.highlight .vc{color:#79c0ff}.highlight .vg{color:#79c0ff}.highlight .vi{color:#79c0ff}.highlight .vm{color:#79c0ff}.highlight .il{color:#a5d6ff}body{font-family:"Open Sans",Helvetica Neue,Helvetica,"Noto Sans KR",Arial,sans-serif;font-size:16px;line-height:28px;color:#404040;background-color:#fbfbfb;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*::selection{color:#fff;background-color:#3af}.toc-container{margin-bottom:20px;display:flex;justify-content:center}.toc{background-color:#fff;border:1px solid #edeeee;border-radius:8px;padding:20px;box-shadow:0 2px 4px rgba(0,0,0,.1);width:100%;font-family:"Noto Sans KR",sans-serif;text-align:left}.toc-title{font-family:"Noto Sans KR",sans-serif;font-size:32px;font-weight:700;color:#05b;margin-bottom:20px;text-align:left;background-color:rgba(204,238,255,.5);padding:15px;border-radius:5px;border:1px solid #ccc}.toc ul{list-style-type:disc;padding-left:15px}.toc a{font-family:"Noto Sans KR",sans-serif;font-size:16px;color:hsl(205,100%,45%);text-decoration:none;display:block;transition:color .3s ease,background-color .3s ease}.toc a:hover{background-color:#eee;color:rgb(0,89.25,153);text-decoration:underline}.toc a:active{color:#05b}.toc .list-group-item.active{background-color:rgba(34,34,34,.8);color:#fff;font-weight:bold;border-radius:5px}.toc .list-group-item.disabled{color:#6c757d;background-color:rgba(0,0,0,0)}.toc .list-group-item+.list-group-item{margin-top:8px}h1,h2,h3,h4,h5,h6{font-family:"Noto Sans KR",serif;font-weight:700;line-height:initial}h1{font-weight:700;font-size:36px;line-height:110%;margin-top:1.6em;margin-bottom:.8em}h2{font-weight:700;font-size:32px;margin-top:1.6em;margin-bottom:.8em}h3{font-weight:700;font-size:28px;margin-top:1.8em;margin-bottom:.9em}h4{font-weight:700;font-size:24px;margin-top:2em;margin-bottom:1em}h5{font-weight:700;font-size:22px;margin-top:2em;margin-bottom:1em;color:#333}h6{font-weight:700;font-size:20px;margin-top:2em;margin-bottom:1em;color:#444}img{max-width:100%;height:auto;vertical-align:middle}img+strong:before{display:inline-block;content:"▲";padding-right:5px;font-size:14px}img+strong{display:block;font-size:14px}p:has(>img):has(>strong){max-width:90%;margin:50px auto;text-align:center}a{text-decoration:none;color:hsl(205,100%,45%);transition:.35s}a:hover{color:rgb(0,89.25,153)}blockquote{padding-left:20px;border-left:4px solid #3af;font-family:"Noto Sans KR",serif;font-style:normal;font-size:14px;background-color:rgb(237.58,248.3,252.32)}blockquote p{padding:10px}hr{height:4px;margin:20px 0;border:0;background-color:#6b6b6b}pre{overflow:auto;padding:14px;font-size:14px;white-space:pre-wrap;word-wrap:break-word;word-break:break-all;font-family:Courier,"Noto Sans KR",monospace}pre.highlight{padding:15px 20px}code{border-radius:10px;overflow:auto;white-space:pre-wrap;word-wrap:break-word;word-break:break-all;font-family:Menlo,Monaco,"Courier New",monospace;font-weight:bold;font-size:14px;vertical-align:middle}p code,li code{color:#eb5757;background-color:#edeeee;margin:0 2px;padding:5px 6px}pre code{font-size:14px;color:#ddd;background-color:rgba(0,0,0,0)}.language-plaintext code{color:#ddd}.o-wrapper{max-width:1440px;position:relative}.o-opacity{animation-duration:.7s;animation-delay:.2s;animation-fill-mode:both;animation-name:opacity}@keyframes opacity{from{opacity:0}to{opacity:1}}.c-btn{display:inline-block;white-space:nowrap;vertical-align:middle;font-family:"Noto Sans KR",serif;font-size:14px;text-align:center;padding:5px 15px;cursor:pointer;transition:.35s}.c-btn--primary{color:#fff;background-color:#3af;background:linear-gradient(135deg, #33aaff 0%, #62d5ff 100%)}.c-btn--secondary{color:#fff;background-color:#cfcfdd;background:linear-gradient(135deg, #a2a2bd 0%, #cfcfdd 100%)}.c-btn--bar{color:#fff;background-color:#444;background:#525252;font-size:14px;width:76%;height:40px}.c-btn--round{border-radius:30px}.c-btn--shadow{box-shadow:8px 10px 20px 0 rgba(46,61,73,.15)}.c-btn--shadow:hover{box-shadow:2px 4px 8px 0px rgba(46,61,73,.2)}.c-btn--middle{display:block;width:300px;max-width:100%}.c-btn--big{display:block;width:100%}.c-btn:hover{color:#fff;transition:.35s}.c-btn:active{transform:translateY(2px)}.c-sidebar{display:flex;flex-direction:column;justify-content:space-between;position:fixed;top:0;left:0;bottom:0;width:360px;padding:40px 20px 20px;text-align:center;box-shadow:1px 1px 0 rgba(31,35,46,.15);background-color:#fff}.c-sidebar-author{display:flex;flex-direction:column}.c-sidebar-author .c-author__cover{width:100px;height:100px;margin:0 auto 10px;border-radius:50%;overflow:hidden;background-color:#cfcfdd}.c-sidebar-author .c-author__cover img{width:100%;height:100%;border-radius:50%;transition:.35s}.c-sidebar-author .c-author__cover img:hover{transform:scale3d(0.9, 0.9, 1)}.c-sidebar-author .c-contact-menu .c-btn{min-width:110px}.c-sidebar-author .c-contact-menu .c-btn .icon{vertical-align:text-bottom;fill:#fff}.c-sidebar-author .c-author__info{font-family:"Noto Sans KR",serif}.c-sidebar-author .c-author__name{font-size:18px;font-weight:700;line-height:21px}.c-sidebar-author .c-author__job{font-size:12px;color:#a0a0a0;margin:5px 0 0}.c-sidebar-author .c-contact-menu{justify-items:center;margin:30px 0px 10px 0px}.c-sidebar-author .c-contact-menu .c-btn{width:130px}.c-sidebar-author .c-contact-menu-bar{justify-items:center;margin:0px 0px 25px 0px}.c-sidebar-author .c-contact-menu-bar .c-btn{font-size:14px;width:260px}.c-sidebar-author .c-author__about{max-width:400px;margin:0 auto 15px;font-size:13px}.c-sidebar-footer .c-social__title{position:relative;font-family:"Noto Sans KR",serif;font-size:16px;font-weight:700;color:#444}.c-sidebar-footer .c-social__title::before{content:"";display:block;height:2px;width:calc(50% - 40px);transform:translateY(-50%);position:absolute;top:50%;left:0;background-color:#444}.c-sidebar-footer .c-social__title::after{content:"";display:block;height:2px;width:calc(50% - 40px);transform:translateY(-50%);position:absolute;top:50%;right:0;background-color:#444}.c-sidebar-footer .c-social__list{list-style-type:none;padding:0;margin:15px 0}.c-sidebar-footer .c-social__list .c-social__item{display:inline-block;width:27px;height:27px}.c-sidebar-footer .c-social__list .icon{width:27px;height:27px;fill:#444;vertical-align:middle;transition:.35s}.c-sidebar-footer .c-social__list .icon:hover{fill:#3af;transform:scale(1.2);transition:.35s}.c-sidebar-footer .c-copyright p{font-size:13px;margin:0}@media only screen and (max-width: 900px){.c-sidebar{position:relative;width:100%;padding:20px}.c-sidebar .c-contact-menu{margin:20px 0}.c-sidebar-footer .c-social .c-social__title{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}.c-sidebar-footer .c-social__list{margin:0}.c-sidebar-footer .c-copyright{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}}@media only screen and (max-width: 480px){.c-sidebar-author{display:flex;flex-direction:column}.c-sidebar-author .c-author__cover{width:80px;height:80px}.c-sidebar-author .c-author__cover img{width:100%;height:100%}.c-sidebar-author .c-contact-menu{justify-items:center;margin:15px 0px 0px 0px;min-width:245px}.c-sidebar-author .c-contact-menu .c-btn{min-width:80px;font-size:12px;width:120px;height:36px;margin-bottom:10px}.c-sidebar-author .c-contact-menu-bar{justify-items:center;margin:0px 0px 25px 0px}.c-sidebar-author .c-contact-menu-bar .c-btn{min-width:80px;font-size:12px;width:244px;height:36px;padding:4px 15px}.c-sidebar-footer .c-social .c-social__title{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}.c-sidebar-footer .c-social__list{margin:0}.c-sidebar-footer .c-social__list .icon{width:25px;height:25px}.c-sidebar-footer .c-copyright{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}}.c-content{position:relative;display:flex;flex-direction:row;flex-wrap:wrap;align-items:stretch;padding:0 20px 0;margin-left:360px}@media only screen and (max-width: 900px){.c-content{position:static;padding:0 15px 0;margin-left:0}}.c-posts{width:100%;display:flex;flex-direction:row;flex-wrap:wrap}.c-post{width:100%;max-width:100%;margin-bottom:20px;display:flex;flex-direction:row;align-items:stretch;min-height:180px;border-radius:10px;overflow:hidden;transition:.35s;background-color:#fff;box-shadow:0 1px 1px 0 rgba(31,35,46,.15)}.c-post:hover{transform:translate(0px, -2px);box-shadow:0 15px 45px -10px rgba(10,16,34,.2)}.c-post .c-post-thumbnail{display:block;width:30%;max-width:100%;min-height:180px;border-radius:10px 0 0 10px;background-color:rgba(220,235,245,.2);background-size:cover;background-position:50% 50%}.c-post .c-post-content{padding:15px;width:70%}.c-post .c-post-content .c-post-title{font-size:30px;font-weight:400;margin:0 0 15px}.c-post .c-post-content .c-post-title a{text-decoration:none;color:#263959}.c-post .c-post-content .c-post-tags{padding:3px 5px;border-radius:3px;background-color:rgba(135,131,120,.2);color:#eb5757;font-size:85%;font-family:"Courier Prime","Noto Sans KR"}.c-post .c-post-content .c-post-date,.c-post .c-post-content .c-post-words{font-size:12px}.c-load-more{padding:20px;margin:20px auto 40px;font-size:13px;color:#fff;border:none;background-color:#3af;outline:none}.c-load-more:hover{background-color:hsl(205,100%,45%)}@media only screen and (max-width: 1200px){.c-post{width:48%;max-width:100%;margin:0 1% 20px;flex-direction:column}.c-post .c-post-thumbnail{width:100%;border-radius:10px 10px 0 0}.c-post .c-post-content{width:100%}.c-post .c-post-content .c-post-title{font-size:21px;margin:15px 0}}@media only screen and (max-width: 480px){.c-post{width:100%;max-width:100%;margin:0 0 20px}.c-post .c-post-content{width:100%}.c-post .c-post-content .c-post-title{font-size:21px;margin:15px 0}}.c-article{width:100%;margin:20px 0}.c-wrap-content{padding:7%;background-color:#fff}.c-article__image{position:relative;background-color:rgba(220,235,245,.2);background-position:center;background-size:cover;background-repeat:no-repeat}.c-article__image:after{content:"";display:block;padding-top:56%}.c-article__header{margin-bottom:60px;padding-bottom:10px;text-align:center;border-bottom:1px solid #6b6b6b}.c-article__header .c-article__title{margin-bottom:10px}.c-article__date span{font-size:13px;text-transform:uppercase;color:#a0a0a0}.c-article__footer{margin:60px 0 0;padding-top:20px;padding-bottom:10px;text-align:center;border-top:1px solid #6b6b6b}.c-article__footer .c-article__share{transition:.35s}.c-article__footer .c-article__share a .icon{vertical-align:middle;transition:.35s}.c-article__footer .c-article__share a .icon:hover{opacity:.7;transition:.35s}.c-article__footer .c-article__tag{margin-bottom:5px}.c-article__footer .c-article__tag a{display:inline-block;vertical-align:middle;padding:5px 10px;font-family:"Noto Sans KR",serif;font-size:10px;line-height:10px;text-transform:uppercase;background-color:rgba(115,138,160,.6);color:#fff}.c-article__footer .c-article__tag a:hover{background-color:rgba(80.2446808511,99.6723404255,118.2553191489,.6)}.c-article__footer .c-article__tag a:last-child{margin-right:0}.c-recent-post{padding:30px 0}.c-recent-post .c-recent__title{font-size:14px;text-align:center;text-transform:uppercase;margin-bottom:30px}.c-recent-post .c-recent__box{display:flex;flex-direction:row;flex-wrap:wrap}.c-recent-post .c-recent__item{max-width:23%;flex-basis:23%;margin:0 1% 20px;border-radius:10px;overflow:hidden;text-align:center;background-color:#fff;box-shadow:0 1px 1px 0 rgba(31,35,46,.15);transition:.35s}.c-recent-post .c-recent__item h4{margin-bottom:5px;font-size:12px;text-transform:uppercase}.c-recent-post .c-recent__item h4 a{color:#444}.c-recent-post .c-recent__item:hover{box-shadow:2px 4px 8px 0px rgba(46,61,73,.2)}.c-recent-post .c-recent__footer{padding:15px}.c-recent-post .c-recent__image{display:block;width:100%;min-height:180px;background-color:rgba(220,235,245,.2);background-size:cover;background-position:center;background-repeat:no-repeat}.c-recent-post .c-recent__date{color:#a0a0a0;font-size:12px}@media only screen and (max-width: 1200px){.c-recent-post .c-recent__item{max-width:48%;flex-basis:48%}}@media only screen and (max-width: 900px){.c-article{margin:15px 0}}@media only screen and (max-width: 480px){.c-wrap-content{padding:15px}.c-article__header{margin-bottom:5px}.c-article__header .c-article__title{font-size:24px;margin-bottom:5px}.c-recent-post .c-recent__item{max-width:100%;flex-basis:100%;margin:0 0 20px}}.c-blog-tags{width:100%;padding:20px;margin:20px 0 40px;background-color:#fff}.c-blog-tags h1{text-align:center;margin-bottom:0}.c-blog-tags h2{font-size:18px;text-transform:uppercase;margin:30px 0;color:#757575}.c-tag__list{list-style:none;padding:0 0 40px;margin:40px 0 0;border-bottom:1px solid #6b6b6b}.c-tag__list li{display:inline-block;margin-right:15px}.c-tag__list li a{color:#404040;text-transform:uppercase;font-size:12px}.c-tag__list li a:hover{color:hsl(0,0%,-4.9019607843%)}.c-tag__item{margin-bottom:15px}.c-tag__image{width:50px;height:50px;border-radius:50%;margin-right:5px}@media only screen and (max-width: 480px){.c-blog-tags{padding:15px}.c-blog-tags h1{font-size:27px}.c-blog-tags h2{font-size:16px;margin:15px 0}.c-tag__list{padding:0 0 30px;margin:30px 0 0}.c-tag__item{margin-bottom:5px}.c-tag__image{display:none}}.c-header{position:relative;width:100%;margin:20px 0}.c-header__box{position:relative;display:flex;flex-direction:row;justify-content:space-between;align-items:center}.c-header__box .icon--ei-search{position:absolute;top:7px;left:15px;fill:#ccc}.c-search{width:80%}.c-search .c-search__box{display:flex;align-items:center}.c-search .c-search__text{position:relative;width:100%;padding:10px 10px 10px 40px;border:1px solid #f2fafd;border-radius:30px;outline:none;color:#a0a0a0}.c-search .c-search__text::placeholder{color:#ccc}.c-search .c-search__text:hover{box-shadow:0 1px 0px rgba(132,135,138,.1);transition:.35s}.c-search .c-search-results-list{position:absolute;width:100%;margin:10px 0 0;list-style-type:none;background-color:#fff;z-index:1}.c-search .c-search-results-list li{display:flex;flex-wrap:wrap;align-items:center;margin:0;padding:20px 25px 0;background-color:#fff;line-height:1.4;border-left:solid 1px #edeeee;border-right:solid 1px #edeeee}.c-search .c-search-results-list li:first-child{border-top-left-radius:5px;border-top-right-radius:5px;border-top:solid 1px #edeeee}.c-search .c-search-results-list li:last-child{border-bottom-left-radius:5px;border-bottom-right-radius:5px;padding-bottom:25px;border-bottom:solid 1px #edeeee}.c-search .c-search-results-list li a{font-size:16px}.c-nav{flex-grow:1;padding-left:20px}.c-nav .c-nav__list{display:flex;justify-content:flex-end}.c-nav .c-nav__list .c-nav__item{display:flex;align-items:center;float:left;padding:4px 10px;font-size:10px;text-transform:uppercase;white-space:nowrap;border:1px solid #f2fafd;box-shadow:0 1px 0px rgba(132,135,138,.4);will-change:transform;transform:translateY(0px);cursor:pointer}.c-nav .c-nav__list .c-nav__item:hover{color:#222;background-color:#fff}.c-nav .c-nav__list .c-nav__item.is-active{box-shadow:0 0 0 rgba(132,135,138,.5);transform:translateY(1px);color:#cfcfdd}.c-nav .c-nav__list .c-nav__item.is-active:hover{background-color:#fbfbfb}.c-nav .c-nav__list .c-nav__item:first-child{border-radius:10px 0 0 10px}.c-nav .c-nav__list .c-nav__item:last-child{border-radius:0 10px 10px 0}.c-nav .c-nav__list .c-nav__item .icon{width:18px;height:18px;margin-right:3px}@media only screen and (max-width: 900px){.c-header{margin:15px 0}}@media only screen and (max-width: 480px){.c-header .c-header__box{flex-direction:column}.c-header .c-search{width:100%}.c-header .c-search .c-search__text{padding:8px 8px 8px 40px}.c-header .c-nav{margin-top:15px}.c-header .c-nav .c-nav__list{justify-content:center}.c-header .c-nav .c-nav__item{padding:4px 8px}}.c-categories{width:100%}.c-categories__list{width:100%;display:flex;flex-direction:row;flex-wrap:wrap}.c-categories__item{max-width:25%;flex-basis:25%;padding:0 10px 20px}.c-categories__link{height:100%;display:flex;flex-direction:column;align-items:center;padding:20px 10px;border-radius:5px;box-shadow:5px 5px 25px rgba(46,61,73,.15);background-color:#fff;transition:.35s}.c-categories__link:hover{box-shadow:2px 4px 8px 0px rgba(46,61,73,.2)}.c-categories__link:hover .c-categories__img .c-categories__more{opacity:1;transition:.35s}.c-categories__link .c-categories__container{width:100%;word-wrap:break-word}.c-categories__link .c-categories__container.c-empty-figure{display:flex;flex-direction:column;justify-content:center;flex-grow:1}.c-categories__img{position:relative;max-width:100%}.c-categories__img figure{position:relative;width:200px;max-width:100%;margin-bottom:20px;overflow:hidden;background-size:cover;background-repeat:no-repeat;background-position:center;border-radius:50%;box-shadow:inset 0 1px 3px rgba(141,165,185,.3)}.c-categories__img figure:after{content:"";display:block;padding-top:100%}.c-categories__img figure:before{content:"";position:absolute;top:0;bottom:0;left:0;right:0;background-color:rgba(0,0,0,.15)}.c-categories__img .c-categories__more{display:inline-block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);font-weight:700;color:#fff;text-transform:uppercase;text-shadow:0 1px 0 rgba(104,172,191,.3);opacity:0;transition:.35s}.c-categories__container{text-align:center}.c-categories__container .c-categories__header{font-size:13px;margin-bottom:10px;font-weight:normal;text-transform:uppercase;color:#404040}.c-categories__container .c-categories__count{font-family:"Noto Sans KR",serif;font-size:12px;color:#404040;margin-bottom:0}.c-categories__container .c-categories__count span{display:inline-block;width:20px;height:20px;line-height:20px;vertical-align:baseline;margin-right:5px;border-radius:50%;color:#fff;background-color:#ee6c6c}@media only screen and (max-width: 1200px){.c-categories .c-categories__item{max-width:33.333%;flex-basis:33.333%}}@media only screen and (max-width: 1050px){.c-categories .c-categories__item{max-width:50%;flex-basis:50%}}@media only screen and (max-width: 480px){.c-categories .c-categories__item{max-width:100%;flex-basis:100%;padding:0 0 20px}}.c-form-box{position:absolute;top:0;width:calc(100% - 40px);min-height:100vh;padding:0 20px;background-color:#fff;z-index:1}.c-form-bnt__close{position:absolute;top:0px;left:0;width:30px;height:30px;cursor:pointer;transition:.35s}.c-form-bnt__close:hover{transform:scale(0.8);opacity:.8}.c-form{position:relative;width:750px;max-width:100%;margin:40px auto}.c-form .c-form__title{margin:0 0 40px;min-width:0;border:0;padding:0;font-family:"Noto Sans KR",serif;text-transform:uppercase;text-align:center}.c-form a{color:#404040}.c-form__group{margin-bottom:20px}.c-form__group label{display:block;text-transform:uppercase;font-size:10px}.c-form__group input,.c-form__group textarea{width:100%;padding:10px 15px;color:#404040;border:1px solid #f2fafd;outline:none;transition:.35s}.c-form__group input:focus,.c-form__group textarea:focus{box-shadow:0 4px 25px rgba(132,135,138,.1)}.c-form__group button{padding:20px;text-transform:uppercase;outline:none;border:none}.c-thank-you p{position:relative;padding:20px 40px;width:750px;max-width:100%;text-transform:uppercase;font-size:12px;line-height:18px;font-weight:700;margin:40px auto 0;text-align:center;color:#fff;background:linear-gradient(135deg, #55b5ad 0%, #5ec9c5 100%)}.c-thank-you p .c-form-bnt__close{width:25px;height:25px;background:rgba(0,0,0,0)}.c-thank-you p a{color:#fff}@media only screen and (max-width: 900px){.c-form-box{width:100%;left:0;right:0}}@media only screen and (max-width: 480px){.c-form-bnt__close{width:25px;height:25px}}.c-newsletter{padding:30px 0 60px;margin:0 auto;border-bottom:1px solid #6b6b6b}.c-newsletter__header{text-align:center}.c-newsletter__header .c-newsletter__title{font-size:14px;text-transform:uppercase;text-align:center}.c-newsletter__header .c-newsletter__subtitle{margin-bottom:15px}.c-newsletter-form{width:100%;max-width:750px;margin:0 auto}.c-newsletter-form .c-newsletter-form__group{display:flex}.c-newsletter__email{width:70%;height:40px;padding:10px 15px;border:1px solid #ddd;border-right-color:rgba(0,0,0,0);outline:none;transition:.35s}.c-newsletter__email:focus{box-shadow:0 4px 25px rgba(132,135,138,.1)}.c-newsletter__button{width:30%;height:40px;color:#fff;background-color:#3af;transition:.35s;border:none;outline:none;cursor:pointer}.c-newsletter__button:hover{background-color:hsl(205,100%,45%)}@media only screen and (max-width: 480px){.c-newsletter__button{font-size:13px}}.c-comments{padding:30px 0;border-top:1px solid #6b6b6b}.c-top{position:fixed;width:40px;height:40px;bottom:20px;color:#05b;background-color:#cef;border-radius:50%;cursor:pointer;transition:.35s;right:-100px;z-index:10;opacity:.5}.c-top--active{right:15px}.c-top:hover{color:#757575;opacity:1}.u-text-left{text-align:left}.u-text-right{text-align:right}.u-text-center{text-align:center}.u-text-justify{text-align:justify}.u-block{display:block}.u-inline-block{display:inline-block}.u-inline{display:inline}.u-full-width{display:block;width:100%}.u-vertical-center{display:flex;align-items:center;justify-content:center}.u-responsive-image{max-width:100%;height:auto;vertical-align:middle}.u-show{display:block !important}.u-hide{display:none !important}.u-invisible{visibility:hidden}.u-float-left{float:left}.u-float-right{float:right}.u-no-padding-top{padding-top:0}.u-no-padding-bottom{padding-bottom:0}.u-no-padding-left{padding-left:0}.u-no-padding-right{padding-right:0}.u-no-padding{padding:0}.u-no-margin-top{margin-top:0}.u-no-margin-bottom{margin-bottom:0}.u-no-margin-left{margin-left:0}.u-no-margin-right{margin-right:0}.u-no-margin{margin:0}.u-lists-reset{list-style-type:none;margin:0;padding:0}.u-clearfix::before,.u-clearfix::after{content:"";display:table;clear:both}.u-screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}
  </style>
  <!-- KaTeX 관련 파일 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      renderMathInElement(document.body, {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "$", right: "$", display: false },
          { left: "\\(", right: "\\)", display: false },
          { left: "\\[", right: "\\]", display: true },
        ],
      });
    });
  </script>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VNMTFT1R2R"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "G-VNMTFT1R2R");
  </script>
</head>


<body>
  
    <script>
  (function (i, s, o, g, r, a, m) {
  i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
    (i[r].q = i[r].q || []).push(arguments)
}, i[r].l = 1 * new Date(); a = s.createElement(o),
    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

  ga('create', 'G-VNMTFT1R2R', 'auto');
  ga('send', 'pageview');

</script> <!-- /google analytics -->
  
  <div class="o-wrapper">
    <aside class="c-sidebar">
  <div class="c-sidebar-author">
    <div class="c-author__cover">
      <a href="/">
        <img src="/images/Profile/profile.png" alt="Dong-Jun Shin">
      </a>
    </div>
    <div class="c-author__info">
      <div class="c-author__name">Dong-Jun Shin</div>
      <span class="c-author__job">Web Developer</span>
    </div>
    <div class="c-contact-menu">
      <div style="width: 100%">
        <a href="/about/profile" class="c-contact-btn c-btn c-btn--secondary c-btn--round c-btn--shadow">
          <div style="
            display: flex;
            flex-direction: row;
            align-items: center;">
            <span data-icon='ei-tag' data-size='s'></span>
            <span>About me</span>
          </div>
        </a>
        
        <a target="_blank" href="https://github.com/Dong-Jun-Shin" class="c-btn c-btn--primary c-btn--round c-btn--shadow">
          <div style="
            display: flex;
            flex-direction: row;
            align-items: center;">
            <span data-icon='ei-sc-github' data-size='s'></span>
            <span>Visit Github</span>
          </div>  
        </a>
      </div>
      
    </div>
    <div class="c-contact-menu-bar">
      <div style="width: 100%">
        <a href="/" class="c-contact-btn c-btn c-btn--bar c-btn--round c-btn--shadow">All Posts</a>
      </div>
    </div>
    <p class="c-author__about">개발자로 성장하며 배운 것을 정리한 블로그</p>
  </div>

  <div class="c-sidebar-footer">
    <div class="c-social">
      <div class="c-social__title">Social</div>
      <ul class="c-social__list u-lists-reset">
        
        <li class="c-social__item"><a href="https://www.linkedin.com/in/kr-jun-shin" target="_blank"><div data-icon='ei-sc-linkedin' data-size='s'></div></a></li>
        
        
        
        
        
        
        
        
        
        
          <li class="c-social__item"><a href="https://youtube.com/channel/UCIHM7drY2vvvFhrhXtpbbzw" target="_blank"><div data-icon='ei-sc-youtube' data-size='s'></div></a></li>
        
        
        
      </ul>
    </div>
    <div class="c-copyright">
      <p>2025 &copy; Dong-Jun Shin</p>
      <!-- <a target="_blank" href="https://analytics.google.com/"><img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fdong-jun-shin.github.io&count_bg=%23FFD540&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=hits&edge_flat=true"/></a> -->
      <a target="_blank" href="https://analytics.google.com/"><img src="https://img.shields.io/badge/Info-Analytics-infomation?style=flat-square&color=yellow"/></a>
      <a target="_blank" href="https://search.google.com/search-console"><img src="https://img.shields.io/badge/Info-Search-informational?style=flat-square"/></a>
    </div>
  </div>
</aside> <!-- /.c-sidebar -->

<main class="c-content">
  <article class="c-article">
  <div class="c-article__content">
    <header class="c-header u-hide u-no-margin-top">
      <div class="c-header__box">
        <div class="c-search u-full-width">
          <div class="c-search__box">
            <label for="js-search-input" class="u-screen-reader-text">Search for Blog</label>
            <input type="text" id="js-search-input" class="c-search__text" autocomplete="off" placeholder="Type to search...">
            <div data-icon='ei-search' data-size='s'></div>
          </div>
          <ul id="js-results-container" class="c-search-results-list"></ul>
        </div>
      </div>
    </header>
    
    <div class="c-article__image o-opacity" style="background-image: url( /images/DevLang_MySQL/logo.png )"></div>
    
    <div class="c-wrap-content">
      <header class="c-article__header">
        <h1 class="c-article__title">MySQL - Gap Lock</h1>
        <div class="c-article__date">
          <span>2023, Dec 11</span>
        </div>
      </header>
      
      <div class="toc-container">
        <div class="toc">
          <div class="toc-title">Index</div>
          <ul><li><a href="#배경">배경</a></li><li><a href="#1-gap-lock이란">1. Gap Lock이란</a></li><li><a href="#2-존재하지-않는-간격을-잠근다는-게-무슨-말인가요">2. 존재하지 않는 간격을 잠근다는 게 무슨 말인가요?</a></li><li><a href="#3-그럼-gap-lock간격은-언제-생성되나요">3. 그럼 Gap Lock(간격)은 언제 생성되나요?</a></li><li><a href="#4-gap-lock이-무엇이고-언제-생성되는건-알겠는데-범위가-지정되는-기준을-모르겠어요">4. Gap Lock이 무엇이고, 언제 생성되는건 알겠는데 범위가 지정되는 기준을 모르겠어요</a></li><li><a href="#5-gap-lock을-사용할-때-주의할-점">5. Gap Lock을 사용할 때 주의할 점</a></li><li><a href="#6-gap-lock-예제">6. Gap Lock 예제</a></li></ul>
        </div>
      </div>
      
      <h2 id="배경">배경</h2>

<p>회사에서 운영중인 서비스에 Dead lock이 주기적으로 발생하고 있는 것을 알게 되었습니다. 왜 Dead lock이 발생했는지, 트래킹하는 과정에서 알게 된 Gap Lock을 공부하며 정리하게 되었습니다.</p>

<h2 id="1-gap-lock이란">1. Gap Lock이란</h2>

<p>일단 예시를 통해 Gap Lock이 왜 생겼는지 설명해보겠습니다.</p>

<p>테이블에 새로운 데이터를 추가하기 위한 서비스가 있고, 이 서비스에 요청이 동시에 들어와 병렬로 처리되어야 하는 상황을 가정해보겠습니다.</p>

<p>이 때, 첫번째 요청의 데이터(A1)와 두번째 요청의 데이터(A2)는 특정 레코드 2개(A0, A10) 사이에 들어가게 됩니다. 그러면 이 2개의 레코드는 같은 위치를 건드리게 되기 때문에 이 공간(간격)에 대한 제어가 필요하게 됩니다.</p>

<p>이런 상황처럼 레코드가 아닌 특정 범위에 추가, 갱신 제한이 필요한 경우가 있고 실제 존재하지 않는 레코드 공간(간격)에 대해 제어권을 얻기 위해 잠그는 것을 Gap Lock이라고 합니다.</p>

<h2 id="2-존재하지-않는-간격을-잠근다는-게-무슨-말인가요">2. 존재하지 않는 간격을 잠근다는 게 무슨 말인가요?</h2>

<p><img src="/images/DevLang_MySQL/2023/12/mysql_gap_lock/1.png" alt="" />
<strong>[DB에 존재하는 테이블 예시]</strong></p>

<p>그림과 같이 아직 추가되어 있지 않은 부분을 Gap(간격)이라고 말하고 있습니다.</p>

<h2 id="3-그럼-gap-lock간격은-언제-생성되나요">3. 그럼 Gap Lock(간격)은 언제 생성되나요?</h2>

<p>Gap Lock은 DML(Insert, Update, Delete) 연산할 때, 조건 컬럼에 Index가 걸려있지 않거나, Index가 Unique하지 않다면 <code class="language-plaintext highlighter-rouge">SELECT .. FOR UPDATE</code>를 했을 때 생성됩니다.</p>

<h2 id="4-gap-lock이-무엇이고-언제-생성되는건-알겠는데-범위가-지정되는-기준을-모르겠어요">4. Gap Lock이 무엇이고, 언제 생성되는건 알겠는데 범위가 지정되는 기준을 모르겠어요</h2>

<p><img src="/images/DevLang_MySQL/2023/12/mysql_gap_lock/1.png" alt="" />
<strong>[DB에 존재하는 테이블 예시]</strong></p>

<p>Gap Lock은 특정 레코드를 기준으로 범위가 지정됩니다. 여기서 특정 레코드는 무엇이고, 이 레코드는 어떻게 선택되며, 이 레코드로 어떻게 범위를 구성하는지 3개의 항목으로 나누어 위 테이블을 예시로 설명하겠습니다.</p>

<ul>
  <li>특정 레코드란?
    <ul>
      <li>Gap Lock의 기준점이 되는 레코드로, 범위 시작(from)부터 범위 끝(to) 중 <code class="language-plaintext highlighter-rouge">범위 끝(to)</code>의 역할을 합니다.</li>
    </ul>
  </li>
  <li>특정 레코드는 어떤 기준으로 선택되나요?
    <ul>
      <li>선택된 Index와 비교 연산(&lt;, &gt;, ≤, ≥) 방식을 통해 선택이 됩니다.
        <ul>
          <li>숫자: 크기 비교</li>
          <li>문자열: 문자열 비교</li>
        </ul>
      </li>
      <li>좀 더 구체적으로 말하면, 우리가 Select 쿼리를 실행했을 때, Where에 어떤 조건이 있는지에 따라 사용하는 Index가 선택되고, 선택된 Index에 해당하는 조건을 순서대로 비교 연산해서 특정 레코드를 선택하는 것과 유사합니다.</li>
      <li>e.g. 선택하는 예시는 아래와 같습니다.
        <ol>
          <li>테이블에는 ID, Name으로 구성된 <code class="language-plaintext highlighter-rouge">idx_dummy_id_name</code>  Unique 인덱스가 있다고 가정해보겠습니다.</li>
          <li>이제 우리는 새로운 레코드(6, D1)를 추가하려고 합니다.</li>
          <li>Entity가 존재하지 않을 때만 추가하기 위해 ID, Name(6, D1)을 조건으로 <code class="language-plaintext highlighter-rouge">SELECT .. FOR UPDATE</code>를 하게 됩니다.</li>
          <li>이 때  <code class="language-plaintext highlighter-rouge">idx_dummy_id_name</code> 인덱스를 사용한다면, Gap Lock을 얻기위해 <code class="language-plaintext highlighter-rouge">ID &gt; 6, Name &gt; ‘D1’</code> 의 조건으로 비교연산을 통해 특정 레코드(8, E)를 얻습니다.</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>특정 레코드가 구성되는 범위는 어떻게 되나요?
    <ul>
      <li>위에 설명한대로 특정 레코드는 <code class="language-plaintext highlighter-rouge">범위 끝(to)</code>의 역할을 합니다. 그럼 <code class="language-plaintext highlighter-rouge">범위 시작(from)</code>을 정해야 하는데, 이건 기준이 되는 Index 조건 컬럼들을 순서대로 비교 연산 기준으로 정렬했을 때, <code class="language-plaintext highlighter-rouge">범위 끝(to)</code> 레코드에서 앞 레코드로 정해집니다.</li>
      <li>만약 Unique index 등 복합 인덱스가 걸려 있다면, Index Sequence에 따라 순차적으로 조건을 비교하게 됩니다. (Gap Lock의 범위를 알고 싶다면 Index Sequence에 따라 순차적으로 판단하면서 알 수 있습니다!)</li>
      <li>이것을 정리하면 Gap Lock의 범위는 <code class="language-plaintext highlighter-rouge">특정 레코드의 앞 레코드 ~ 특정 레코드</code>로 정의할 수 있습니다.</li>
      <li>e.g. 특정 레코드의 앞 레코드(5, D) ~ 특정 레코드(8, E)</li>
    </ul>
  </li>
</ul>

<h2 id="5-gap-lock을-사용할-때-주의할-점">5. Gap Lock을 사용할 때 주의할 점</h2>

<ul>
  <li>Gap Lock은 아래와 같은 상황에서 Dead Lock이 발생할 수 있기 때문에 주의가 필요합니다.
    <ul>
      <li>복수의 트랜잭션이 서로 <code class="language-plaintext highlighter-rouge">SELECT .. FOR UPDATE</code>를 하면 서로 같은 GAP LOCK을 얻게 되고 DML 처리를 하면 Dead Lock이 발생</li>
    </ul>
  </li>
  <li>B-Tree Index에 대해 구성된 페이지들의 마지막 레코드가 조회 범위에 포함되면 특정 레코드 대신 <code class="language-plaintext highlighter-rouge">supremum pseudo-record(Index가 가지는 가장 큰 가상의 시스템 값)</code> 가 선택될 수 있습니다.
    <ul>
      <li>범위를 조회하며 <code class="language-plaintext highlighter-rouge">SELECT .. FOR UPDATE</code>의 조건에 해당하는 레코드와 간격을 잠그고, 마지막 레코드까지 왔다면 그 다음 레코드(supremum record)에 대해 같은 Lock 절차를 밟게 됩니다. 그리고 다음 페이지의 레코드를 읽어 조건이 일치하지 않을 때까지 Lock 절차를 진행합니다.</li>
      <li>이 문제는 아래의 방법을 통해 피할 수 있습니다.
        <ul>
          <li>Isolation Level을 Read-Committed로 수정
            <ul>
              <li>Read-Committed는 Gap Lock을 거의 사용하지 않기 때문에, Gap Lock의 성격을 가진 <code class="language-plaintext highlighter-rouge">supremum record</code> 는 사용되지 않게 됩니다.</li>
            </ul>
          </li>
          <li><code class="language-plaintext highlighter-rouge">BETWEEN AND</code> 키워드 대신 <code class="language-plaintext highlighter-rouge">IN</code>을 사용
            <ul>
              <li><code class="language-plaintext highlighter-rouge">IN</code>은 조건 여러개를 합친 동등(=) 비교로 실행되기 때문에, Unique함이 보장되어 Gap Lock을 사용하지 않게 됩니다.</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="6-gap-lock-예제">6. Gap Lock 예제</h2>

<p>같은 DB에 접속한 Client 1, Client 2에 아래 쿼리를 입력하면서 Gap Lock의 생성과 Gap Lock에 의한 대기를 확인할 수 있습니다. 또 예제 데이터를 Index 값의 경계 부근 값(특정 레코드의 기준 컬럼 값이 ‘5’라면 4, 4.9, 5.1, 6 등)으로 대입하면서 확인해보면 더 깊게 Gap Lock을 이해하실 수 있을 겁니다.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* 테스트 환경 구성 시작 */</span>
<span class="c1">-- 테스트를 위해 Client 1의 Auto commit을 비활성화</span>
<span class="k">SET</span> <span class="n">AUTOCOMMIT</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>
<span class="k">SHOW</span> <span class="n">VARIABLES</span> <span class="k">LIKE</span> <span class="s1">'%autocommit%'</span><span class="p">;</span>
<span class="c1">-- 복합인덱스로 구성된 테이블 생성</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">example_compound_index</span> <span class="p">(</span>
<span class="n">id</span> <span class="nb">INT</span> <span class="n">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
<span class="n">uuid</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">),</span>
<span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="n">other_column</span> <span class="nb">INT</span><span class="p">,</span>
<span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="n">idx_uuid_name</span> <span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="p">);</span>
<span class="c1">-- 예제 데이터 삽입 (uuid의 맨 앞과 뒤를 수정하여 연속되지 않고 범위가 생기도록 함)</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">example_compound_index</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">other_column</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'123e4567-e89b-12d3-a456-426614174001'</span><span class="p">,</span> <span class="s1">'John1'</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">example_compound_index</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">other_column</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'123e4567-e89b-12d3-a456-426614174005'</span><span class="p">,</span> <span class="s1">'John2'</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">example_compound_index</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">other_column</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'923e4567-e89b-12d3-a456-426614174001'</span><span class="p">,</span> <span class="s1">'John3'</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">example_compound_index</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">other_column</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'923e4567-e89b-12d3-a456-426614174002'</span><span class="p">,</span> <span class="s1">'John4'</span><span class="p">,</span> <span class="mi">400</span><span class="p">);</span>
<span class="cm">/* 테스트 환경 구성 끝 */</span>

<span class="cm">/* Client 1에서 실행하는 쿼리 */</span>
<span class="c1">-- Client 1의 Transaction 시작</span>
<span class="k">START</span> <span class="n">TRANSACTION</span><span class="p">;</span>
<span class="c1">-- 123..005 보다 큰 123..008을 조회했기 때문에 923..001 레코드가 Gap Lock의 기준이 됨</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">example_compound_index</span> <span class="k">WHERE</span> <span class="n">uuid</span> <span class="o">=</span> <span class="s1">'123e4567-e89b-12d3-a456-426614174008'</span> <span class="k">AND</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'John4'</span> <span class="k">FOR</span> <span class="k">UPDATE</span><span class="p">;</span>
<span class="cm">/* Client 1에서 실행하는 쿼리 끝 */</span>

<span class="cm">/* Client 2에서 실행하는 쿼리 */</span>
<span class="c1">-- 테스트를 위해 Client 2의 Auto commit을 비활성화</span>
<span class="k">SET</span> <span class="n">AUTOCOMMIT</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>
<span class="k">SHOW</span> <span class="n">VARIABLES</span> <span class="k">LIKE</span> <span class="s1">'%autocommit%'</span><span class="p">;</span>

<span class="c1">-- Client 2의 Transaction 시작</span>
<span class="k">START</span> <span class="n">TRANSACTION</span><span class="p">;</span>
<span class="c1">-- Client 1에 의해 923..001 레코드 Gap Lock이 생겨있고, '5as..0w3'이나 '6as..0w3'은 '123..005 ~ 923..001' 사이에 추가하기 때문에 대기</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">example_compound_index</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">'5asdasds-weio-wef2-iju9-2389070fj0w3'</span><span class="p">,</span> <span class="s1">'John2'</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">example_compound_index</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">'6asdasds-weio-wef2-iju9-2389070fj0w3'</span><span class="p">,</span> <span class="s1">'John2'</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="cm">/* Client 2에서 실행하는 쿼리 끝 */</span>

<span class="cm">/* 상태 확인을 위한 쿼리 */</span>
<span class="c1">-- Transaction, 생성된 Lock, Lock에 의해 대기중인 쿼리 확인</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">INNODB_TRX</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">performance_schema</span><span class="p">.</span><span class="n">DATA_LOCKS</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">performance_schema</span><span class="p">.</span><span class="n">DATA_LOCK_WAITS</span><span class="p">;</span>

<span class="c1">-- Transaction 종료를 위한 쿼리</span>
<span class="k">COMMIT</span><span class="p">;</span>
<span class="k">ROLLBACK</span><span class="p">;</span>
</code></pre></div></div>


      <div class="c-article__footer u-clearfix">
        <div class="c-article__tag">
          
          <a href="/tags#mysql">&#35; mysql</a>
          
          <a href="/tags#dead_lock">&#35; dead_lock</a>
          
          <a href="/tags#gap_lock">&#35; gap_lock</a>
          
        </div>
        <div class="c-article__share">
          <a href="https://twitter.com/intent/tweet?text=MySQL%20-%20Gap%20Lock&url=https://dong-jun-shin.github.io/2023/12/11/mysql_gap_lock/" title="Share
          on Twitter" rel="nofollow" target="_blank"><div data-icon='ei-sc-twitter' data-size='s'></div></a>
          <a href="https://facebook.com/sharer.php?u=https://dong-jun-shin.github.io/2023/12/11/mysql_gap_lock/" title="Share on Facebook" rel="nofollow" target="_blank"><div data-icon='ei-sc-facebook' data-size='s'></div></a>
          <a href="https://plus.google.com/share?url=https://dong-jun-shin.github.io/2023/12/11/mysql_gap_lock/" title="Share on Google+" rel="nofollow" target="_blank"><div data-icon='ei-sc-google-plus' data-size='s'></div></a>
        </div>
      </div>
      <div class="c-newsletter">
  <div class="c-newsletter__header">
    <h4 class="c-newsletter__title">Newsletter</h4>
    <div class="c-newsletter__subtitle">Subscribe to this blog and receive notifications of new posts by email.</div>
  </div>
  <form class="c-newsletter-form validate" action="#" method="POST" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
    <div class="c-newsletter-form__group">
      <label class="u-screen-reader-text" for="mce-EMAIL">Email address</label>
      <input class="c-newsletter__email required email" id="mce-EMAIL" type="email" name="EMAIL" placeholder="Your email address" autocomplete="on">
      <input class="c-newsletter__button" id="mc-embedded-subscribe" type="submit" name="subscribe" value="Subscribe">
    </div>
  </form>
</div> <!-- /.c-newsletter -->
      <div class="c-recent-post">
        <h4 class="c-recent__title">You might also enjoy</h4>
        <div class="c-recent__box">
        
        
          <div class="c-recent__item">
            <a class="c-recent__image" href="/2025/01/10/permutation_and_combination_implements/" style="background-image: url( /images/CS_Algorithm/2025/01/permutation_and_combination_implements/thumbnail.png)"></a>
            <div class="c-recent__footer">
              <h4><a href="/2025/01/10/permutation_and_combination_implements/">순열과 조합 - 2, 경우의 수 뿐만 아니라 경우를 직접 구해보자</a></h4>
              <div class="c-recent__date">
                <time datetime="2025-01-10T17:45:03+09:00">January 10, 2025</time>
              </div>
            </div>
          </div>
        
        
        
          <div class="c-recent__item">
            <a class="c-recent__image" href="/2025/01/10/permutation_and_combination_theory/" style="background-image: url( /images/CS_Algorithm/2025/01/permutation_and_combination_theory/thumbnail.png)"></a>
            <div class="c-recent__footer">
              <h4><a href="/2025/01/10/permutation_and_combination_theory/">순열과 조합 - 1, 어떤 원리로 경우의 수를 계산할 수 있는걸까?</a></h4>
              <div class="c-recent__date">
                <time datetime="2025-01-10T17:45:02+09:00">January 10, 2025</time>
              </div>
            </div>
          </div>
        
        
        
          <div class="c-recent__item">
            <a class="c-recent__image" href="/2024/08/21/2_years_of_experience_from_2022/" style="background-image: url( /images/Life/2024/08/2_years_of_experience_from_2022/thumbnail_retrospective-journey.jpg)"></a>
            <div class="c-recent__footer">
              <h4><a href="/2024/08/21/2_years_of_experience_from_2022/">퇴사 회고(라 쓰고, 2022년 ~ 2024년 정리)</a></h4>
              <div class="c-recent__date">
                <time datetime="2024-08-21T23:47:38+09:00">August 21, 2024</time>
              </div>
            </div>
          </div>
        
        
        
          <div class="c-recent__item">
            <a class="c-recent__image" href="/2024/05/21/Aws_Summit_Seoul_2024/" style="background-image: url( /images/IT_Tech/2024/05/Aws_Summit_Seoul_2024/thumbnail.png)"></a>
            <div class="c-recent__footer">
              <h4><a href="/2024/05/21/Aws_Summit_Seoul_2024/">AWS Summit Seoul 2024 방문기</a></h4>
              <div class="c-recent__date">
                <time datetime="2024-05-21T21:55:48+09:00">May 21, 2024</time>
              </div>
            </div>
          </div>
        
        
        </div>
      </div> <!-- /.c-recent-post -->
      
        <div class="c-comments">
  <div id="disqus_thread" class="article-comments"></div>
  <script>
    (function () {
      var d = document, s = d.createElement('script');
      s.src = '//dong-jun-shin-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
</div> <!-- /.c-comments -->
      
    </div> <!-- /.c-wrap-content -->
  </div> <!-- /.c-article__content -->
</article> <!-- /.c-article-page -->

</main> <!-- /.c-content -->
  </div> <!-- /.o-wrapper -->
  <div class="c-top" data-icon='ei-chevron-up' data-size='s' title="Scroll To Top"></div> <!-- /.c-top -->
  <script src="/js/jquery-3.3.1.min.js"></script>
<script src="/js/evil-icons.min.js"></script>
<script src="/js/jquery.fitvids.js"></script>
<script src="/js/simple-jekyll-search.min.js"></script>
<script src="/js/main.js"></script>
<!-- /javascripts -->
</body>
</html>